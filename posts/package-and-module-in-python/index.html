<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
<link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />



<link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />


<link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />


<link href='&#x2F;icons&#x2F;apple-touch-icon.png' rel="apple-touch-icon" sizes="180x180" />

  

<link href='https:&#x2F;&#x2F;ianchen.tw&#x2F;main.css' rel="preload" as="style" />
<link href='https:&#x2F;&#x2F;ianchen.tw&#x2F;main.css' rel="stylesheet" />


  
  

  <title>
     IanChen | Python 的 package 與 module 
  </title>

  
  <script src="https://kit.fontawesome.com/ab28266223.js" crossorigin="anonymous"></script>

  
  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116173804-1"></script>
  <script type="text/javascript">
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "UA-116173804-1");
  </script>


</head>

<body class="">
  <nav id="navbar" aria-label="section navigation" class="navbar" role="navigation">
<div class="container">
    <div class="navbar-brand">
    <a id="navbar-title" class="navbar-item has-text-weight-bold" href="/about">IanChen</a>
    <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    </div>
    <div class="navbar-menu" id="navMenu">
        <div class="navbar-start">
            
                <a class="navbar-item" href='https:&#x2F;&#x2F;ianchen.tw&#x2F;about'>
                    About
                </a>
            
                <a class="navbar-item" href='https:&#x2F;&#x2F;ianchen.tw&#x2F;posts'>
                    Posts
                </a>
            
                <a class="navbar-item" href='https:&#x2F;&#x2F;ianchen.tw&#x2F;tags'>
                    Tags
                </a>
            
                <a class="navbar-item" href='https:&#x2F;&#x2F;ianchen.tw&#x2F;archives'>
                    Archives
                </a>
            
        </div>
        <div class="navbar-end has-text-centered">
            <a class="navbar-item" darkmode-switch-button id="dark-mode" title="Switch to dark theme">
            <span class="icon">
                <i class="fas fa-adjust"></i>
            </span>
            </a>
        </div>
    </div>
</div>
</nav>

  
  

  
<section class="section pb-0">
  <div class="container">
    <div class="columns">
      <div class="column is-6 is-offset-3">
        <article>
          <h1 class="title">Python 的 package 與 module</h1>
          <h2 class="subtitle"></h2>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="theme-color-dimmed">
    <a href="/about">
      
        <img class="avatar" src="&#x2F;images&#x2F;avatar.jpg">
      
    </a>
    
      <a href="/about">
        <span class='author-name'>
          奕安
        </span>
      </a>
      published on
    
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2018-03-13'>March 13, 2018</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    9 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    1705 words
  </p>

            </div>
            <div class="column is-4">
              
            </div>
            <div class="column is-8 has-text-right-desktop">
               
  <p>
    <span class="has-text-weight-normal">Tags:</span>
    
      <a class="link" href='https:&#x2F;&#x2F;ianchen.tw&#x2F;tags&#x2F;python&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        python
      </a>
    
      <a class="link" href='https:&#x2F;&#x2F;ianchen.tw&#x2F;tags&#x2F;cheng-shi&#x2F;'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        程式
      </a>
    
  </p>
 
            </div>
          </div>
          <div class="content has-text-justified">
            <p>這篇是閱讀 <a href="https://docs.python.org/3/tutorial/modules.html">python3官方文件-Module</a> 並進行測試後的一些理解
文中也會提供我認為的使用方法以及實際在專案中遇到的問題跟解決方式。</p>
<p><img src="https://ianchen.tw/posts/package-and-module-in-python/python_interpreter.png" alt="python interpreter" /></p>
<span id="continue-reading"></span>
<p>文章會先從 <code>Modlue</code>(模組)下手，再依序提到 <code>Pacakge</code> 的概念。其次再比較兩者在 import 時的差別。</p>
<h2 id="module-mo-zu">Module (模組)</h2>
<p>在python專案的組建架構中，模組可以說是最小的層級。任何一個以 .py為副檔名的 python 程式碼都被視為模組。
比如說以下的 hello.py就是一個簡單的模組。在這種情況下，<strong>也可以說有一個模組叫做 hello</strong></p>
<pre style="background-color:#2b2c2f;">
<code class="language-python" data-lang="python"><span style="color:#5f6364;">#hello.py
</span><span style="color:#c594c5;">def </span><span style="color:#6699cc;">say_hi</span><span style="color:#5fb3b3;">():
    </span><span style="color:#6699cc;">print</span><span style="color:#5fb3b3;">(&#39;</span><span style="color:#99c794;">Hello, World!</span><span style="color:#5fb3b3;">&#39;)

</span><span style="color:#c594c5;">if </span><span style="color:#cccece;">__name__ </span><span style="color:#5fb3b3;">== &#39;</span><span style="color:#99c794;">__main__</span><span style="color:#5fb3b3;">&#39;:
    </span><span style="color:#6699cc;">say_hi</span><span style="color:#5fb3b3;">()
</span></code></pre><h3 id="if-name-main">if __name__ == &quot;__main__&quot;</h3>
<p>在剛剛的例子裡面，有寫到 <code>if __name__ == '__main__' </code> 這個判斷式，這是 python interpreter 用來分辨這個模組是被直接執行還是被其他模組匯入(import)的重要機制。python interpreter在開始執行之後就會初始化 <code>__name__</code> 這個特別的環境變數，當我們直接執行某個模組的時候，<code>__name__</code> 變數就會被設為<code>__main__</code>這個字串值。</p>
<pre style="background-color:#2b2c2f;">
<code class="language-sh" data-lang="sh"><span style="color:#6699cc;">python hello.py
</span><span style="color:#5f6364;"># --- 所謂的直接執行，就是這個意思。
</span></code></pre>
<p>如果想知道當前 interpreter有哪些環境變數的話，可以在直接呼叫 <code>dir()</code> 函式，__name__ 變數就跑出來了。</p>
<p><img src="https://ianchen.tw/posts/package-and-module-in-python/python_interpreter.png" alt="python interpreter" /></p>
<h3 id="hui-ru-ji-you-mo-zu">匯入既有模組</h3>
<p>一般來說，會把 python 程式碼存在檔案中就是為了重複使用這些程式碼，也就是把一些函式包含在 <code>hello</code> 這個模組中。</p>
<p><img src="https://ianchen.tw/posts/package-and-module-in-python/module_import_1.png" alt="mod import" /></p>
<p>假設現在同一個資料夾下的另一個檔案 <code>another.py</code>中想要使用 <code>hello.py</code> 中的函式，我們可以將 hello.py 模組匯入(import)。</p>
<pre style="background-color:#2b2c2f;">
<code class="language-python" data-lang="python"><span style="color:#5f6364;"># another.py
</span><span style="color:#c594c5;">import </span><span style="color:#cccece;">hello
</span><span style="color:#c594c5;">if </span><span style="color:#cccece;">__name__ </span><span style="color:#5fb3b3;">== &#39;</span><span style="color:#99c794;">__main__</span><span style="color:#5fb3b3;">&#39;:
    </span><span style="color:#6699cc;">hello</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">say_hi</span><span style="color:#5fb3b3;">()
</span></code></pre>
<p>官方文件中有提到，<strong>為了提升效率，不管專案中有幾個檔案匯入同個模組，任何模組都只會被執行一次。<strong>此外，在匯入模組的時候，interpreter會把模組裡面的句子</strong>都先執行過一次</strong>，除非是初始化的片段，不然我都會把他包在另外的函式裡面，避免副作用(side effect) 產生。</p>
<p>python也支援不同的import模式，可以直接查看 <a href="https://docs.python.org/3/tutorial/modules.html#more-on-modules">官方文件</a> 來進一步了解。</p>
<h2 id="package-tao-jian">Package(套件)</h2>
<p>在一個專案架構中，除了可以依據功能將不同函式放在同一個模組中。也可以用同樣的依據將相似的模組放在同一個資料夾中。python將套件作為資料夾架構的強化版本。在官方文件中的定義，任何含有 <code>__init__.py</code>的資料夾就稱為一個套件。<code>__init__.py</code>可以是全空的文件，也可以定義額外內容來產生額外作用。詳見 <a href="https://docs.python.org/3/tutorial/modules.html#tut-packages">官方文件</a> 。</p>
<p>我想以目前正在開發的簡單小專案為例解釋套件的用法。在 <code>Github</code> 上面，我有一個放置自己設定檔案的 repo，並在其中附上了一個支援多平台的快速安裝小專案，命名為 <strong>autosetup</strong>，以下是資料夾的架構。</p>
<pre style="background-color:#2b2c2f;">
<code><span style="color:#cccece;">+ /autosetup
    + /installers
        + \_\_init\_\_.py
        + viminstaller.py
        + pyinstaller.py
    + \_\_init\_\_.py
    + \_\_main\_\_.py
    + setup.py
    + config.py
    + util.py
</span></code></pre>
<p><code>setup.py</code>是專案中的主程式，他會分別呼叫<code>installers</code>資料夾中的不同安裝腳本。而那些安裝腳本會分別從<code>util.py</code>匯入常用函式。所有的程式都會從 <code>config.py</code> 中匯入一些使用者設定。</p>
<p>依據剛剛的定義，這個大資料夾中其實包含了兩個套件，分別是 <code>autosetup</code> 跟<code>installers</code>,而且因為 <code>installers</code>套件是存在於<code>autosetup</code>套件下，所以可以將 <code>installers</code> 稱為 <code>autosetup</code>的<strong>子套件(subpackage)</strong>。</p>
<p>python提供<code>絕對(absolute)</code>跟<code>相對(relative)</code>兩種不同的匯入方法。簡單來說。絕對的說法就是尋找一個固定的參考點來描述物體位置，而相對是透過另一個會變動的參考來描述物體位置，假設我想要描述<strong>交通大學</strong>的位址。</p>
<ul>
<li>絕對路徑的描述邏輯: 新竹市大學路1001號</li>
<li>相對路徑的描述邏輯: 就...<strong>清華大學</strong>店隔壁的學校</li>
</ul>
<p>兩者的差別就只是參照的角度不一樣，更多的觀念可以查看 <a href="http://linux.vbird.org/linux_basic/0220filemanager.php#dir_pathway">鳥哥的linux私房菜</a>。</p>
<p>在絕對路徑中，python interpreter 會<strong>預先偵測目前最上層的套件名稱</strong>。在存取時都是以最上層開始一層層往下解析名稱。而相對路徑則是以當前檔案進行存取，<code>.</code>代表當前目錄,在這一外每多一個點都是往上一層套件的意思。可以使用 <code>..util</code>, <code>...util</code>等等...，要注意一下..跟後面的套件名稱不能分開。</p>
<h3 id="1-cong-zi-tao-jian-zhong-hui-ru">1. 從子套件中匯入</h3>
<ul>
<li>從 <code>setup.py</code> 匯入 <code>installer.py</code> 跟 <code>config.py</code> (匯入子套件的模組)</li>
</ul>
<pre style="background-color:#2b2c2f;">
<code class="language-python" data-lang="python"><span style="color:#5f6364;">#setup.py 
</span><span style="color:#c594c5;">from .</span><span style="color:#cccece;">installers </span><span style="color:#c594c5;">import </span><span style="color:#cccece;">pyinstaller </span><span style="color:#5f6364;">#相對路徑匯入
</span><span style="color:#c594c5;">from </span><span style="color:#cccece;">autosetup</span><span style="color:#5fb3b3;">.</span><span style="color:#cccece;">installer </span><span style="color:#c594c5;">import </span><span style="color:#cccece;">pyinstaller </span><span style="color:#5f6364;">#絕對路徑匯入
</span></code></pre><h3 id="2-cong-shang-ceng-tao-jian-zhong-hui-ru">2. 從上層套件中匯入</h3>
<ul>
<li>從 <code>pyinstaller.py</code> 匯入 <code>util.py</code> 的 <code>install_program</code> 函式</li>
</ul>
<pre style="background-color:#2b2c2f;">
<code class="language-python" data-lang="python"><span style="color:#5f6364;">#pyinstaller.py
</span><span style="color:#c594c5;">from ..</span><span style="color:#cccece;">util </span><span style="color:#c594c5;">import </span><span style="color:#cccece;">install_program </span><span style="color:#5f6364;">#相對路徑匯入
</span><span style="color:#c594c5;">from </span><span style="color:#cccece;">autosetup </span><span style="color:#c594c5;">import </span><span style="color:#cccece;">install_program </span><span style="color:#5f6364;">#絕對路徑匯入
</span></code></pre><h3 id="main-py">__main__.py</h3>
<p>把一個專案打包成套件之後，或許也會想要有一個屬於專案的程式執行點，讓整個專案能夠簡單運行起來，就如同模組是可以被執行的，套件其實也是可以執行的。在模組裡面可以使用 <code>if __name__ == '__main__'</code>來達到效果，對應到套件中就是 <code>__main__.py</code>了。當我們執行一套件時，python interpreter 會去尋找套件目錄下的 <code>__main__.py</code>，並執行它，所以只要把對應的程式碼寫在 <code>__main__.py</code> 之中就可以了。</p>
<pre style="background-color:#2b2c2f;">
<code class="language-python" data-lang="python"><span style="color:#5f6364;">#__main__.py
</span><span style="color:#c594c5;">from . import </span><span style="color:#cccece;">setup
</span><span style="color:#c594c5;">if </span><span style="color:#cccece;">__name__ </span><span style="color:#5fb3b3;">==  &#39;</span><span style="color:#99c794;">__main__</span><span style="color:#5fb3b3;">&#39;:
    </span><span style="color:#6699cc;">setup</span><span style="color:#5fb3b3;">.</span><span style="color:#6699cc;">main</span><span style="color:#5fb3b3;">()
</span></code></pre><h2 id="hui-ru-ji-zhi-jie-shuo">匯入機制解說</h2>
<p>python的匯入機制其實十分簡單，但對新手來說卻存在一些小陷阱。
稍微注意一下可以發現，我把 relative/absolute import 專門寫在了 package 的標題下方。依據我自己的理解方式，匯入的機制分別依據模組跟套件有兩種不同規則。</p>
<ul>
<li>
<p>在模組中</p>
<p>只能透過 sys.path 中有指定的目錄來進行匯入，所以如果單純想要匯入上層目錄的模組，就必須先使用sys.path.append('..')之後才能直接匯入。</p>
</li>
<li>
<p>在套件中
可以使用 相對/絕對 的方式來進行其他模組或套件的存取。</p>
</li>
</ul>
<h2 id="shi-yong-xin-de">使用心得</h2>
<p>我認為模組跟套件是python語言非常核心的概念之一。在python語言中，如果是想要達到包裝或是命名空間的效果的話，不一定要使用 class 方法，可以視情況採用套件來達到目的。</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


   
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a
              class="button is-outlined"
              href="https:&#x2F;&#x2F;ianchen.tw&#x2F;posts&#x2F;python-ros3-setting&#x2F;"
            >
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
               ros+python3設定
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a
              class="button is-outlined"
              href="https:&#x2F;&#x2F;ianchen.tw&#x2F;posts&#x2F;2018-lets-talk-about-this-blog&#x2F;"
            >
              談談這個部落格<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>
 

    

  <footer class="py-4">
  <p class="has-text-centered">© 2018 Ian Chen</p>
</footer>

  <script src="https:&#x2F;&#x2F;ianchen.tw&#x2F;js&#x2F;site.js"></script>
    

</body>

</html>